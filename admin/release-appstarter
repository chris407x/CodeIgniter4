#!/bin/bash

## Build app starter distributable

# Setup variables
. admin/release-config
TARGET=dist/appstarter
cd $TARGET
git checkout $branch

#---------------------------------------------------
echo -e "${BOLD}Build the framework distributable${NORMAL}"

echo -e "${BOLD}Copy the main files/folders...${NORMAL}"
releasable='application public writable README.md contributing.md env license.txt spark'
for fff in $releasable ; do
    if [ -d "$fff" ] ; then
        rm -rf $fff
    fi
    cp -rf ${CI_DIR}/$fff .
done

echo -e "${BOLD}Override as needed...${NORMAL}"
cp -rf ${CI_DIR}/admin/starter/* .

echo -e "${BOLD}Fix paths...${NORMAL}"
sed -i "/public $systemDirectory = 'system';/s/'system'/'vendor/codeigniter4/framework/system'/" application/Config/Paths.php

#---------------------------------------------------
# And finally, get ready for merging
echo -e "${BOLD}Assemble the pieces...${NORMAL}"
git add .
git commit -S -m "Release ${RELEASE}"
git checkout master
git merge $branch

cd $CI_DIR

#---------------------------------------------------
# Done for now
echo -e "${BOLD}Distributable app starter ready..${NORMAL}"
